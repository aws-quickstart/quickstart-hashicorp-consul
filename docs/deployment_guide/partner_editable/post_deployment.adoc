// Include any postdeployment steps here, such as steps necessary to test that the deployment was successful. If there are no postdeployment steps, leave this file empty.

== Postdeployment steps

=== Access Consul using SSH (Secure Shell)
To access the Consul environment, first connect to one of the deployed bastion hosts. Then, use an SSH agent to forward your private key on connection. For more information on SSH agents, refer to https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent[Generating a new SSH key and adding it to the ssh-agent^].

WARNING: Do not copy your private key to the bastion host.

If you use macOS or Linux, complete the following steps.

[start=1]
. Sign in to the https://us-east-1.console.aws.amazon.com/console/home?region=us-east-1#[AWS Management Console^]. Then open the Amazon EC2 console.
. Choose *Instances* from the left navigation pane.
. Choose one of the two deployed bastion hosts (*LinuxBastion1* or *LinuxBastion2*). Note the *Elastic IP* value for the selected instance. You will enter this in Step 7.

+
[#ec2panel]
.Elastic IP address for a bastion host instance
[link=images/ec2-panel.png]
image::../docs/deployment_guide/images/ec2-panel.png[Architecture,width=648,height=439]

[start=4]
. Choose a *Consul-Server* or *Consul-Client* instance and note its *Private IPs* value. You will enter this in Step 9.

+
[#ec2consulip]
.Finding the private IP address for Consul-Server
[link=images/ec2-consul-ip.png]
image::../docs/deployment_guide/images/ec2-consul-ip.png[Architecture,width=648,height=439]

[start=5]
. Run the following command.
[source, bash]
----
ssh-add ~/.ssh/id_rsa
----

[start=6]
. Enter your passphrase or press `Enter`.

[start=7]
. Run the following command to connect to the bastion host. Substitute your *Elastic IP* value from Step 3 for `34.198.50.12`.

+
[source, bash]
----
ssh –A ubuntu@34.198.50.12
----

+
[#ec2ssh]
.Connecting to bastion host
[link=images/ec2-ssh-1.png]
image::../docs/deployment_guide/images/ec2-ssh-1.png[Architecture,width=648,height=439]

[start=8]
. Enter `yes` when prompted to continue connecting.


[start=9]
. From the bastion host, connect to the Consul-Server or Consul-Client host using Ubuntu as the user. Substitute your *Private IP* value from Step 4 for `172.31.35.7`.

+
[source, bash]
----
ssh –A ubuntu@172.31.35.7
----

+
[#ec2ssh2]
.Connecting to Consul-Server or Consul-Client
[link=images/ec2-ssh-2.png]
image::../docs/deployment_guide/images/ec2-ssh-2.png[Architecture,width=648,height=439]

[start=10]
. Run the following command to view Consul members.

+
[source, bash]
----
consul members
----

+
[#ec2ssh3]
.Consul members
[link=images/ec2-ssh-3.png]
image::../docs/deployment_guide/images/ec2-ssh-3.png[Architecture,width=648,height=439]

=== Test the deployment

Test the deployment by accessing the Consul dashboard.

. Sign in to the https://us-east-1.console.aws.amazon.com/console/home?region=us-east-1#[AWS Management Console^]. Then open the Amazon CloudFormation console.
. Choose *Stacks* from the left navigation pane.
. Choose the Hashicorp Consul stack.
. Choose the *Outputs* tab.
. To access the Consul dashboard, navigate to the URL in the *Value* column for the *ConsulServerELB* key.

+
[#elb]
.ConsulServerELB
[link=images/elb.png]
image::../docs/deployment_guide/images/elb.png[Architecture,width=648,height=439]

+
The landing page for the Consul dashboard is the *Services* page. For more information, refer to https://learn.hashicorp.com/tutorials/consul/get-started-explore-the-ui?in=consul/getting-started[Explore the Consul UI^].

=== Get started with Consul
* To integrate Consul with your environment and get started with Consul services, refer to https://www.consul.io/intro/getting-started/services.html[Register a Service with Consul Service Discovery^].

* To set up a service on the Consul client nodes, you must register the service and proxy with Consul. For more information, refer to https://learn.hashicorp.com/consul/getting-started/connect#register-the-service-and-proxy-with-consul[Register a Service with Consul Service Discovery^]

* Autopilot operator command is enabled by default with the following settings.

+
[source, bash]
----
"autopilot": {
 "cleanup_dead_servers": true,
 "last_contact_threshold": "200ms",
 "max_trailing_logs": 250,
 "server_stabilization_time": "10s",
 "redundancy_zone_tag": "az",
 "disable_upgrade_migration": false,
 "upgrade_version_tag": ""
}
----

+
For more information, refer to https://www.consul.io/docs/commands/operator/autopilot.html[Consul Operator Autopilot^].

// == Post deployment steps
// If Post-deployment steps are required, add them here. If not, remove the heading

// == Best practices for using {partner-product-name} on AWS
// Provide post-deployment best practices for using the technology on AWS, including considerations such as migrating data, backups, ensuring high performance, high availability, etc. Link to software documentation for detailed information.

// _Add any best practices for using the software._

// == Security
// Provide post-deployment best practices for using the technology on AWS, including considerations such as migrating data, backups, ensuring high performance, high availability, etc. Link to software documentation for detailed information.

// _Add any security-related information._

